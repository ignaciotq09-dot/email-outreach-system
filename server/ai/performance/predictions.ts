import { EmailIntent } from '../optimization-orchestrator';
import { INDUSTRY_BENCHMARKS } from './benchmarks';
import type { PerformanceMetrics } from './types';

export function predictPerformance(score: number, context: { intent?: EmailIntent; industry?: string; companySize?: string; previousEngagement?: boolean; followUpNumber?: number } = {}): PerformanceMetrics {
  const benchmarks = INDUSTRY_BENCHMARKS[context.industry as keyof typeof INDUSTRY_BENCHMARKS] || INDUSTRY_BENCHMARKS.default; let openRate: number, responseRate: number, conversionRate: number;
  if (score >= 80) { openRate = benchmarks.openRate.high; responseRate = benchmarks.responseRate.high; conversionRate = benchmarks.conversionRate.high; } else if (score >= 60) { openRate = benchmarks.openRate.avg + (score - 60) / 20 * (benchmarks.openRate.high - benchmarks.openRate.avg); responseRate = benchmarks.responseRate.avg + (score - 60) / 20 * (benchmarks.responseRate.high - benchmarks.responseRate.avg); conversionRate = benchmarks.conversionRate.avg + (score - 60) / 20 * (benchmarks.conversionRate.high - benchmarks.conversionRate.avg); } else { openRate = benchmarks.openRate.low + (score / 60) * (benchmarks.openRate.avg - benchmarks.openRate.low); responseRate = benchmarks.responseRate.low + (score / 60) * (benchmarks.responseRate.avg - benchmarks.responseRate.low); conversionRate = benchmarks.conversionRate.low + (score / 60) * (benchmarks.conversionRate.avg - benchmarks.conversionRate.low); }
  openRate = applyOpenRateModifiers(openRate, context); responseRate = applyResponseRateModifiers(responseRate, context); conversionRate = applyConversionRateModifiers(conversionRate, context); const confidence = calculateConfidence(score, context);
  return { openRate: Math.round(openRate * 10) / 10, responseRate: Math.round(responseRate * 10) / 10, conversionRate: Math.round(conversionRate * 100) / 100, confidence };
}

function applyOpenRateModifiers(baseRate: number, context: any): number { let rate = baseRate; if (context.previousEngagement) rate *= 1.5; if (context.followUpNumber) rate *= Math.max(0.7, 1 - (context.followUpNumber * 0.1)); if (context.intent === EmailIntent.BREAKUP) rate *= 1.3; else if (context.intent === EmailIntent.VALUE_DELIVERY) rate *= 1.2; return Math.min(95, rate); }
function applyResponseRateModifiers(baseRate: number, context: any): number { let rate = baseRate; if (context.previousEngagement) rate *= 2.0; if (context.companySize === 'startup') rate *= 1.3; else if (context.companySize === 'enterprise') rate *= 0.7; if (context.intent === EmailIntent.MEETING_REQUEST) rate *= 0.8; else if (context.intent === EmailIntent.VALUE_DELIVERY) rate *= 1.3; return Math.min(50, rate); }
function applyConversionRateModifiers(baseRate: number, context: any): number { let rate = baseRate; if (context.previousEngagement) rate *= 3.0; if (context.companySize === 'startup') rate *= 1.5; else if (context.companySize === 'enterprise') rate *= 0.5; return Math.min(20, rate); }
function calculateConfidence(score: number, context: any): number { let confidence = 50; confidence += (score - 50) * 0.5; if (context.industry) confidence += 10; if (context.companySize) confidence += 5; if (context.previousEngagement !== undefined) confidence += 10; if (context.intent) confidence += 5; return Math.min(95, Math.max(20, confidence)); }
